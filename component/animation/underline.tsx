'use clinet';
import { motion, useInView } from 'framer-motion';
import styles from './animation.module.scss';
import React, { useEffect, useRef } from 'react';

export default function Underline({ children, delay = 500, color = '#ec694e' }: { children: string, delay?: number, color: string }) {

    const ref = useRef<HTMLSpanElement>(null)
    const inView = useInView(ref, {margin: '-100px 0px -100px 0px'})
    const outView = !useInView(ref, {margin: '400px 0px 400px 0px'})

    const [isInView, setIsInView] = React.useState(inView)

    useEffect(()=>{
        if (inView) setIsInView(true)
        if (outView) setIsInView(false)
    },[inView,outView])

    const text : React.ReactNode[] = children.split('').map((char, index) => {
        return (
            <motion.span key={index} animate={{color:isInView ? color : '#333', fontWeight:isInView ? 700 : 'inherit'}} transition={{delay:isInView ? delay + 0.2 + (index * 0.03) : 0}}>
                {char}
            </motion.span>
        )
    })
    
    const pathAnimate = {
        // strokeDashoffset: isInView ? 0 : 231,
        // strokeDasharray: 231,
        strokeDashoffset: isInView ? 0 : 380,
        strokeDasharray: 380,
    }

    return (
        <span ref={ref} className={styles.underline}>
            <motion.svg className={styles.animated}
                preserveAspectRatio="none"
                // viewBox="0 0 193 12"
                viewBox="0 0 286 26"
            >
                <motion.path
                    animate={pathAnimate}
                    transition={{delay: isInView ? delay : 0,ease:'easeInOut',duration: isInView ? 0.8 : 0}}
                    // d="m1.52979,1.88303c0,0 -0.06696,0.13455 0,0.3764c0.19531,0.70505 0.69751,1.45667 1.38019,2.50943c0.70282,1.08383 1.22754,2.05273 2.133,3.26221c0.70941,0.9476 1.44141,1.88959 2.63489,2.38394c0.84393,0.34955 1.90424,0.45859 2.5094,0.25095c1.06152,-0.3642 1.8645,-1.03085 3.01129,-1.75659c1.23645,-0.78247 2.20673,-1.81805 3.3877,-2.76035c0.84369,-0.67316 1.4845,-1.53333 2.133,-2.00754c0.73035,-0.53406 0.8783,-0.75281 1.2547,-0.75281c0.12549,0 0.64862,-0.1246 1.00378,0c0.75812,0.26593 1.27716,1.22342 2.5094,2.133c1.151,0.84961 2.43353,1.85931 4.01508,2.25848c1.2226,0.30859 2.66827,0.23349 3.63861,-0.12549c1.05255,-0.38937 1.99353,-1.14758 3.13678,-2.00754c1.36383,-1.02588 2.38397,-1.75656 3.3877,-2.25845c0.50189,-0.25095 1.00916,-0.28732 1.12927,-0.25095c0.43298,0.1311 0.90063,0.98462 1.75659,2.00754c1.03113,1.23227 1.98267,2.49698 3.26221,3.13675c1.27954,0.6398 2.55658,0.75565 3.88959,0.37643c1.61908,-0.4606 3.06415,-1.6907 4.6424,-3.01132c1.43054,-1.19699 2.33521,-2.12006 3.3877,-2.5094c0.48523,-0.17947 1.01428,-0.00616 1.38019,0.62735c0.64612,1.11865 1.21497,2.30423 2.5094,3.3877c1.09705,0.91824 2.76953,1.56564 4.6424,1.38019c1.91003,-0.18912 3.44843,-1.21133 5.01886,-2.38394c1.08746,-0.81195 2.00751,-1.2547 2.5094,-1.2547c0.3764,0 0.79523,0.57974 1.50568,1.2547c0.90961,0.86417 1.98688,1.37943 3.13672,1.50565c1.37195,0.1506 2.74518,-0.5278 4.01508,-1.2547c1.36444,-0.78101 2.51788,-1.37653 3.3877,-1.2547c0.9046,0.12671 1.44489,1.05887 2.133,1.75659c0.81226,0.82364 1.50568,1.12921 2.38397,1.12921c1.38013,0 2.87836,-0.89462 4.51691,-1.6311c1.99866,-0.89832 3.47894,-1.63477 5.14429,-2.00754c1.73157,-0.38757 2.93732,-0.56839 3.88959,-0.25095c0.59515,0.19839 1.05536,0.83972 1.6311,1.25473c0.4552,0.32809 1.04871,0.55536 1.88208,0.25092c1.11182,-0.40616 2.47003,-1.69281 4.01508,-2.63486c1.10291,-0.67249 2.17273,-1.04663 2.5094,-0.8783c0.5611,0.28055 0.50189,1.12921 0.8783,1.50565c0.12543,0.12546 0.53009,0.22433 1.12921,0c0.94733,-0.35471 1.50568,-0.62735 2.00757,-0.62735c0.3764,0 0.43726,0.35776 1.00372,0.62735c0.4671,0.22232 1.1731,0.25961 2.5094,-0.25095c1.57251,-0.6008 2.97357,-1.69217 4.39148,-1.88205c0.62183,-0.08328 1.12927,0.62735 1.6311,1.6311c0.50189,1.00375 0.87915,1.52634 1.12927,1.50565c0.76062,-0.06296 1.66772,-1.12927 2.5094,-1.6311c1.16071,-0.69205 2.3877,-0.93961 2.8858,-0.8783c0.51349,0.0632 0.89154,0.8725 1.38019,2.00751c0.64496,1.4982 1.39612,2.71234 2.133,3.63867c0.55237,0.69434 1.42346,0.88846 2.00751,0.62735c1.14545,-0.51215 1.76154,-1.89166 3.01129,-2.88583c0.92633,-0.73694 1.50568,-1.00375 1.88214,-1.00375c0.12537,0 0.24304,0.50778 0.62732,1.00375c0.49207,0.63507 0.91052,1.43271 1.50562,1.6311c0.83325,0.27777 1.90125,-0.46844 3.01135,-1.12921c1.40576,-0.83673 2.30615,-1.81226 3.01123,-2.00754c0.48364,-0.13397 0.89966,0.36716 1.38013,1.50565c0.52551,1.24503 1.03601,2.311 1.63123,2.5094c0.47607,0.15866 1.71387,-0.77341 3.01123,-1.88205c1.61877,-1.38327 2.92285,-2.75345 4.01501,-3.01129c0.97693,-0.23065 1.50574,0.37637 2.38403,1.2547c1.00366,1.00375 2.11597,1.96402 3.13672,2.133c1.4906,0.24673 3.03979,-0.33502 4.51697,-1.38016c1.53638,-1.08704 2.57458,-2.25772 3.51318,-2.63489c0.47998,-0.19287 0.45386,-0.11591 0.50183,0c0.27161,0.65579 1.33411,1.18915 2.13306,1.75659c1.19287,0.84729 2.53882,1.28549 3.88953,1.75659c0.90222,0.31467 1.51086,0.60815 2.00757,0.75281c0.38086,0.11093 0.62732,0.12549 1.00378,0.12549c0.37634,0 1.00366,-0.25095 1.50562,-0.25095c0.8783,0 1.61438,0.0683 2.5094,0.25095c0.99121,0.20227 1.49634,0.18787 2.13293,0.25092c0.49951,0.04947 1.00378,0.12549 1.38025,0.12549l0,0"
                    d="m4,4c6.28235,25.09801 10.36077,4.58823 16.35292,5.7098c5.99215,1.12157 7.26274,6.79215 10.54116,7.01176c3.27843,0.21961 5.00392,-10.66665 11.67842,-10.14901c6.6745,0.51765 1.27843,9.86666 6.72156,10.09411c5.44313,0.22745 8.93332,-7.50587 15.17645,-7.96078c6.24313,-0.4549 1.91372,6.45489 8.31372,6.52548c6.39999,0.07059 15.52939,-7.37254 21.72547,-7.55293c6.19607,-0.18039 4.69803,13.01175 10.89411,12.77646c6.19607,-0.23529 -1.74117,-13.64704 10.42352,-13.19214c12.16469,0.4549 13.49802,10.18822 18.83919,9.67842c5.34117,-0.5098 6.7294,-10.86273 11.43528,-11.00391c4.70588,-0.14118 2.94902,15.27841 8.18823,15.349c5.23921,0.07059 7.74117,-13.59214 13.62351,-13.46665c5.88235,0.12549 3.3647,10.2745 10.58038,10.52548c7.21568,0.25098 11.11371,-10.22744 14.47841,-10.46273c3.3647,-0.23529 4.11764,8.10195 9.23921,8.06274c5.12156,-0.03922 4.98039,-7.52156 10.58038,-8.26666c5.59999,-0.7451 13.61567,9.19215 17.35684,8.9647c3.74117,-0.22745 7.38038,-8.24313 11.96861,-8.07058c4.58823,0.17255 6.21176,6.76862 11.0745,6.26666c4.86274,-0.50196 3.81176,-10.12548 9.4196,-10.32156c5.60784,-0.19608 10.14116,5.7098 13.62351,13.31763"
                    strokeWidth={7}
                    fill="none"
                    stroke={color}
                    strokeLinecap='round'
                />
            </motion.svg>
            {text}
        </span>
    )
}